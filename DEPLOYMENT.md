# TrackMyMoney - Render Deployment Guide

## Overview
This guide helps you deploy the Spring Boot backend to Render using Docker.

---

## ğŸ“ File Structure

```
backend/
â”œâ”€â”€ Dockerfile                 # Production-ready multi-stage build
â”œâ”€â”€ .dockerignore             # Excludes unnecessary files from Docker build
â”œâ”€â”€ pom.xml
â”œâ”€â”€ mvnw
â”œâ”€â”€ src/
â””â”€â”€ ...

render.yaml                     # Render deployment configuration (at project root)
```

---

## ğŸ³ Dockerfile Explanation

### Multi-Stage Build (Optimized)

**Stage 1: Builder**
- Uses Maven image to compile the application
- Makes mvnw executable: `chmod +x mvnw`
- Runs: `./mvnw clean package -DskipTests`
- Output: JAR file

**Stage 2: Runtime**
- Uses lightweight JRE-only image (Alpine Linux)
- Sets proper character encoding (`UTF-8`) to prevent charset errors
- Copies pre-built JAR from Stage 1
- **Much smaller** final image (~180-200MB vs 500MB+)
- Faster startup and deployment

### Key Features
- **JVM Tuning**: G1GC garbage collector for better memory management
- **Memory**: Uses 75% of container RAM (respects resource limits)
- **Character Encoding**: UTF-8 properly configured to prevent charset errors
- **Health Check**: Monitors application with extended startup grace period (15s)
- **Port**: Automatically reads `PORT` environment variable from Render

---

## ğŸ”§ Configuration Changes

### 1. application.properties
Updated to use environment variable for port:
```properties
server.port=${PORT:8080}
```
- Reads `PORT` from Render
- Falls back to `8080` for local development

### 2. Database Configuration
Already configured with environment variables:
```properties
spring.datasource.url=${SPRING_DATASOURCE_URL:...}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:...}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:...}
```

---

## ğŸ“‹ Deployment Steps

### Step 1: Prepare Repository
```powershell
cd C:\Users\rajes\Desktop\TrackMyMoney

# Initialize git if not already done
git init
git add .
git commit -m "Add Docker configuration for Render deployment"
```

### Step 2: Push to GitHub
```powershell
# Add remote (replace with your GitHub repo)
git remote add origin https://github.com/Rajeshpenupothu/trackmymoney.git

# Push to main branch
git branch -M main
git push -u origin main
```

### Step 3: Deploy on Render

1. **Go to**: https://render.com
2. **Login** with GitHub account
3. **Create New** â†’ **Web Service**
4. **Connect** your GitHub repository
5. **Configure**:
   - **Name**: `trackmymoney-backend`
   - **Root Directory**: `backend`
   - **Environment**: `Docker`
   - **Branch**: `main`
   - **Build Command**: (Leave empty - Docker handles it)
   - **Start Command**: (Leave empty - Dockerfile ENTRYPOINT runs it)

6. **Add Environment Variables** in Render Dashboard:
   - `SPRING_DATASOURCE_URL`: Your Neon database URL
   - `SPRING_DATASOURCE_USERNAME`: Neon username
   - `SPRING_DATASOURCE_PASSWORD`: Neon password (keep secret!)

7. **Deploy** â†’ Wait 3-5 minutes

---

## ğŸŒ Environment Variables Reference

| Variable | Source | Example |
|----------|--------|---------|
| `PORT` | Render (automatic) | Generated by Render |
| `SPRING_DATASOURCE_URL` | Set in Render | `jdbc:postgresql://...` |
| `SPRING_DATASOURCE_USERNAME` | Set in Render | `neondb_owner` |
| `SPRING_DATASOURCE_PASSWORD` | Set in Render | Your password (secret) |

### How Render Sets PORT
Render automatically assigns a port and sets the `PORT` environment variable. Your app reads it via:
```
server.port=${PORT:8080}
```

---

## ğŸš€ API Testing After Deployment

Once deployed, test your endpoints:
```bash
# Get the Render URL from dashboard
RENDER_URL="https://your-app.onrender.com"

# Test health check
curl $RENDER_URL/api/health

# Register a user
curl -X POST $RENDER_URL/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"name":"John","email":"john@example.com","password":"pass123"}'

# Login
curl -X POST $RENDER_URL/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"john@example.com","password":"pass123"}'
```

---

## ğŸ“Š Dockerfile Build Optimization

### Image Sizes
- **Maven Builder Stage**: ~400MB (not in final image)
- **Final Runtime Image**: ~180-200MB (Alpine + JRE + JAR)
- **Savings**: ~50% smaller than alternative approaches

### Build Time
- **First build**: ~3-5 minutes (Render free tier)
- **Subsequent builds**: ~2-3 minutes (cached layers)
- **Maven caching**: Speeds up dependency downloads

---

## ğŸ” Security Best Practices

1. **Never commit secrets** to git
   - Use Render's environment variable dashboard
   - Mark sensitive vars as "private" in Render

2. **Use HTTPS** (Render provides automatically)

3. **Database SSL** (Neon):
   - Already enabled: `sslmode=require`

4. **CORS** (if frontend is separate):
   - Configure in `application.properties` if needed

---

## ğŸ› Troubleshooting

### Build Fails
```
Check Render logs:
1. Go to Service â†’ Logs
2. Look for compilation errors
3. Run locally: ./mvnw clean package -DskipTests
```

### App Won't Start
```
1. Check environment variables are set
2. Verify Neon database is online
3. Check logs: "Failed to connect to datasource"
```

### Port Issues
```
If PORT variable not working, check:
- application.properties has: server.port=${PORT:8080}
- Render hasn't set a custom port (unlikely)
```

### Cold Start Slow
```
Expected first deployment: 30-60 seconds
Reason: JVM startup + Spring Boot initialization
Solution: Free tier can be slow; upgrade for faster starts
```

---

## ğŸ“ Deployment Checklist

- [ ] Dockerfile created in `backend/`
- [ ] .dockerignore created  
- [ ] application.properties uses `${PORT:8080}`
- [ ] Neon database credentials ready
- [ ] Git repository initialized and pushed
- [ ] Render account created
- [ ] Web Service connected to GitHub
- [ ] Environment variables set in Render
- [ ] Deployment completed
- [ ] API endpoints tested

---

## ğŸ”„ Redeployment

After code changes:
```powershell
git add .
git commit -m "Describe changes"
git push origin main
```

Render will:
1. Detect push
2. Rebuild Docker image
3. Redeploy automatically (if auto-deploy enabled)

---

## ğŸ“š Additional Resources

- [Spring Boot on Render](https://render.com/docs/deploy-spring-boot)
- [Render Environment Variables](https://render.com/docs/environment-variables)
- [Neon PostgreSQL](https://neon.tech/docs)
- [Docker Multi-Stage Builds](https://docs.docker.com/build/building/multi-stage/)

---

## âœ… You're Ready!

Once deployed, your frontend can connect to:
```
https://your-app.onrender.com/api/
```

Update frontend `api.js` with your Render service URL.
